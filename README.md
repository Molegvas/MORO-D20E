# MORO-D20
2020.02.21
 ESP32 + M0

### 		Особенности аппаратной реализации проекта
***
   Отличие проекта от предыдущих в основном связано с применением драйвера силового преобразователя. Обработка сигналов датчиков тока (их два), напряжения, перегрузки по току возложено на контроллер вместо аналогового блока ранее. Выбор контроллера скорее гипотетический. Исследовался принцип. Оптимальный выбор представляется таким: тактовая частота 48МГц, 12-разрядный АЦП с не менее чем 6-8 каналами, аналоговый компаратор с задаваемым уровнем срабатывания, SPI-порт для связи с центральным процессором. Цена должна быть сопоставима с аналоговой схемой на rail-to-rail операционниках. Цена инструментария может быть достаточно высокой. Выигрыш может оказаться совсем с необычной стороны - на проблемную часть - открытое ПО, а прошивка драйвера авторская, защищенная от копирования.
Главный секрет фирмы - там!
  ***
   Предварительный подсчет показывает, что высвобождается место примерно 4-5 десятков комплектующих с соответствущим сокращением поверхности платы для лучшего теплоотвода.
***
   Подсчитана примерная стоимость комплектации платы за исключением трансформаторов и радиаторов - около 1950 рублей, включая дисплей за 450р (1.8" TFT полноцветный, с подсветкой. Цены брались с этого ресурса: https://teta.online/ Подсчет приведен в файле plist.txt.
***
   Протокол связи между ESP32 и драйвером источника предполагается заимствовать у УРК-2Т - пакетный с контролем контрольных сумм и подтверждениями. Как? Вы не знали, что там "всё по-взрослому"? 
***
   За основу периферии была взята модель кулона 912. Силовые транзисторы и диод в корпусе ТО-247. Параметры могут быть оптимизированы в части уменьшения разброса, который в конечном виде ведет к повышенному тепловыделению в части устройств.
***
   Подключение к датчикам тока и напряжения произведено по дифференциальной схеме с целью исключения сдвига показаний из-за падения напряжения на силовых проводах. В дальнейшем можно будет исполнить 4-х проводную схему подключения батареи, что реализовано у конкурентов. 
***
   Подключение выхода драйвера для управления силовым преобразователем выполнено по парафазной системе с целью определиться с оптимальным управлением в момент подачи питания (рестарта).
***
   Топология платы позволяет устанавливать дисплеи TFT 1.8" 128*160 и LCD 128*128 SPI-3. Последний, правда пока без подсветки (размеры неизвестны).
***
   Вместо кнопочной клавиатуры возможна установка энкодера (как у кулона 720).
***
   Карточки памяти нет, но есть USB порт типа "B", выведенный на заднюю панель, там же держатель предохранителя, сетевой выключатель и кнопка сброса. WiFi и BT никуда не делись.
***
   Предполагается забыть о подключении батареи через клеммы. Многожильные провода в силиконовой изоляции сечением AWG-12 достаточно мягкие, с низким сопротивлением и хорошо паяются.
***
   О продуваемости объема прибора - радиаторы развернуты на 180 градусов по сравнению с 912-м и перестали перекрывать свободный проход воздуха от вентилятора. Плата нигде не прикмыкает к боковым стенкам прибора. Термочувствительные компоненты находятся в холодной зоне прибора - у задней стенки. Осталось выяснить как будет дисплей.
 *** 
   Предполагается, что двусторонняя плата с толщиной по меди 35мкм с каждой стороны обеспечит возможность повысить диапазон тока заряда и разряда. Ширина дорожек и длина оптимизированы.
***
   Прибор оснащен датчиком тока на эффекте Холла. Измерение малых токов таким датчиком затруднительно, но выше нескольких сотен миллиампер возможно любой полярности. Измерение тока разряда снимет массу вопросов пользователей. При добавлении внешнего токового разъема можно реализовать регулируемый пользователем ток разряда в пределах порядка 10 ампер без выделения тепла в самом приборе, но с его измерением, отображением и записью прибором.
***
   ... и это ещё не всё ...
 